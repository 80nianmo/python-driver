<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upgrading &mdash; Cassandra Driver 2.7.2 documentation</title>
    
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Cassandra Driver 2.7.2 documentation" href="index.html" />
    <link rel="next" title="Performance Notes" href="performance.html" />
    <link rel="prev" title="Getting Started" href="getting_started.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="performance.html" title="Performance Notes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cassandra Driver 2.7.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Upgrading</a><ul>
<li><a class="reference internal" href="#upgrading-to-2-1-from-2-0">Upgrading to 2.1 from 2.0</a><ul>
<li><a class="reference internal" href="#using-the-v3-native-protocol">Using the v3 Native Protocol</a></li>
<li><a class="reference internal" href="#working-with-user-defined-types">Working with User-Defined Types</a></li>
<li><a class="reference internal" href="#customizing-encoders-for-non-prepared-statements">Customizing Encoders for Non-prepared Statements</a></li>
<li><a class="reference internal" href="#using-client-side-protocol-level-timestamps">Using Client-Side Protocol-Level Timestamps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrading-to-2-0-from-1-x">Upgrading to 2.0 from 1.x</a><ul>
<li><a class="reference internal" href="#using-the-v2-native-protocol">Using the v2 Native Protocol</a></li>
<li><a class="reference internal" href="#automatic-query-paging">Automatic Query Paging</a></li>
<li><a class="reference internal" href="#protocol-level-batch-statements">Protocol-Level Batch Statements</a></li>
<li><a class="reference internal" href="#sasl-based-authentication">SASL-based Authentication</a></li>
<li><a class="reference internal" href="#lightweight-transactions">Lightweight Transactions</a></li>
<li><a class="reference internal" href="#calling-cluster-shutdown">Calling Cluster.shutdown()</a></li>
<li><a class="reference internal" href="#deprecations">Deprecations</a></li>
<li><a class="reference internal" href="#dependency-changes">Dependency Changes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="getting_started.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="performance.html"
                        title="next chapter">Performance Notes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/upgrading.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="upgrading">
<h1>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="upgrading-to-2-1-from-2-0">
<h2>Upgrading to 2.1 from 2.0<a class="headerlink" href="#upgrading-to-2-1-from-2-0" title="Permalink to this headline">¶</a></h2>
<p>Version 2.1 of the DataStax Python driver for Apache Cassandra
adds support for Cassandra 2.1 and version 3 of the native protocol.</p>
<p>Cassandra 1.2, 2.0, and 2.1 are all supported.  However, 1.2 only
supports protocol version 1, and 2.0 only supports versions 1 and
2, so some features may not be available.</p>
<div class="section" id="using-the-v3-native-protocol">
<h3>Using the v3 Native Protocol<a class="headerlink" href="#using-the-v3-native-protocol" title="Permalink to this headline">¶</a></h3>
<p>By default, the driver will attempt to use version 2 of the
native protocol.  To use version 3, you must explicitly
set the <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal"><span class="pre">protocol_version</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that protocol version 3 is only supported by Cassandra 2.1+.</p>
<p>In future releases, the driver may default to using protocol version
3.</p>
</div>
<div class="section" id="working-with-user-defined-types">
<h3>Working with User-Defined Types<a class="headerlink" href="#working-with-user-defined-types" title="Permalink to this headline">¶</a></h3>
<p>Cassandra 2.1 introduced the ability to define new types:</p>
<div class="highlight-python"><div class="highlight"><pre>USE KEYSPACE mykeyspace;

CREATE TYPE address (street text, city text, zip int);
</pre></div>
</div>
<p>The driver generally expects you to use instances of a specific
class to represent column values of this type.  You can let the
driver know what class to use with <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.register_user_type" title="cassandra.cluster.Cluster.register_user_type"><code class="xref py py-meth docutils literal"><span class="pre">Cluster.register_user_type()</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">zipcode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="n">street</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zipcode</span> <span class="o">=</span> <span class="n">zipcode</span>

<span class="n">cluster</span><span class="o">.</span><span class="n">register_user_type</span><span class="p">(</span><span class="s">&#39;mykeyspace&#39;</span><span class="p">,</span> <span class="s">&#39;address&#39;</span><span class="p">,</span> <span class="n">Address</span><span class="p">)</span>
</pre></div>
</div>
<p>When inserting data for <code class="docutils literal"><span class="pre">address</span></code> columns, you should pass in
instances of <code class="docutils literal"><span class="pre">Address</span></code>.  When querying data, <code class="docutils literal"><span class="pre">address</span></code> column
values will be instances of <code class="docutils literal"><span class="pre">Address</span></code>.</p>
<p>If no class is registered for a user-defined type, query results
will use a <code class="docutils literal"><span class="pre">namedtuple</span></code> class and data may only be inserted
though prepared statements.</p>
<p>See <a class="reference internal" href="user_defined_types.html#udts"><span>User Defined Types</span></a> for more details.</p>
</div>
<div class="section" id="customizing-encoders-for-non-prepared-statements">
<h3>Customizing Encoders for Non-prepared Statements<a class="headerlink" href="#customizing-encoders-for-non-prepared-statements" title="Permalink to this headline">¶</a></h3>
<p>Starting with version 2.1 of the driver, it is possible to customize
how Python types are converted to CQL literals when working with
non-prepared statements.  This is done on a per-<a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session" title="cassandra.cluster.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>
basis through <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.encoder" title="cassandra.cluster.Session.encoder"><code class="xref py py-attr docutils literal"><span class="pre">Session.encoder</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">cql_encode_tuple</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="getting_started.html#type-conversions"><span>Type Conversions</span></a> for the table of default CQL literal conversions.</p>
</div>
<div class="section" id="using-client-side-protocol-level-timestamps">
<h3>Using Client-Side Protocol-Level Timestamps<a class="headerlink" href="#using-client-side-protocol-level-timestamps" title="Permalink to this headline">¶</a></h3>
<p>With version 3 of the native protocol, timestamps may be supplied by the
client at the protocol level.  (Normally, if they are not specified within
the CQL query itself, a timestamp is generated server-side.)</p>
<p>When <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal"><span class="pre">protocol_version</span></code></a> is set to 3 or higher, the driver
will automatically use client-side timestamps with microsecond precision
unless <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.use_client_timestamp" title="cassandra.cluster.Session.use_client_timestamp"><code class="xref py py-attr docutils literal"><span class="pre">Session.use_client_timestamp</span></code></a> is changed to <code class="xref py py-const docutils literal"><span class="pre">False</span></code>.
If a timestamp is specified within the CQL query, it will override the
timestamp generated by the driver.</p>
</div>
</div>
<div class="section" id="upgrading-to-2-0-from-1-x">
<h2>Upgrading to 2.0 from 1.x<a class="headerlink" href="#upgrading-to-2-0-from-1-x" title="Permalink to this headline">¶</a></h2>
<p>Version 2.0 of the DataStax Python driver for Apache Cassandra
includes some notable improvements over version 1.x.  This version
of the driver supports Cassandra 1.2, 2.0, and 2.1.  However, not
all features may be used with Cassandra 1.2, and some new features
in 2.1 are not yet supported.</p>
<div class="section" id="using-the-v2-native-protocol">
<h3>Using the v2 Native Protocol<a class="headerlink" href="#using-the-v2-native-protocol" title="Permalink to this headline">¶</a></h3>
<p>By default, the driver will attempt to use version 2 of Cassandra&#8217;s
native protocol. You can explicitly set the protocol version to
2, though:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>When working with Cassandra 1.2, you will need to
explicitly set the <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal"><span class="pre">protocol_version</span></code></a> to 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="automatic-query-paging">
<h3>Automatic Query Paging<a class="headerlink" href="#automatic-query-paging" title="Permalink to this headline">¶</a></h3>
<p>Version 2 of the native protocol adds support for automatic query
paging, which can make dealing with large result sets much simpler.</p>
<p>See <a class="reference internal" href="query_paging.html#query-paging"><span>Paging Large Queries</span></a> for full details.</p>
</div>
<div class="section" id="protocol-level-batch-statements">
<h3>Protocol-Level Batch Statements<a class="headerlink" href="#protocol-level-batch-statements" title="Permalink to this headline">¶</a></h3>
<p>With version 1 of the native protocol, batching of statements required
using a <a class="reference external" href="http://cassandra.apache.org/doc/cql3/CQL.html#batchStmt">BATCH cql query</a>.
With version 2 of the native protocol, you can now batch statements at
the protocol level. This allows you to use many different prepared
statements within a single batch.</p>
<p>See <a class="reference internal" href="api/cassandra/query.html#cassandra.query.BatchStatement" title="cassandra.query.BatchStatement"><code class="xref py py-class docutils literal"><span class="pre">BatchStatement</span></code></a> for details and usage examples.</p>
</div>
<div class="section" id="sasl-based-authentication">
<h3>SASL-based Authentication<a class="headerlink" href="#sasl-based-authentication" title="Permalink to this headline">¶</a></h3>
<p>Also new in version 2 of the native protocol is SASL-based authentication.
See the section on <a class="reference internal" href="security.html#security"><span>Security</span></a> for details and examples.</p>
</div>
<div class="section" id="lightweight-transactions">
<h3>Lightweight Transactions<a class="headerlink" href="#lightweight-transactions" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.datastax.com/dev/blog/lightweight-transactions-in-cassandra-2-0">Lightweight transactions</a> are another new feature.  To use lightweight transactions, add <code class="docutils literal"><span class="pre">IF</span></code> clauses
to your CQL queries and set the <a class="reference internal" href="api/cassandra/query.html#cassandra.query.Statement.serial_consistency_level" title="cassandra.query.Statement.serial_consistency_level"><code class="xref py py-attr docutils literal"><span class="pre">serial_consistency_level</span></code></a>
on your statements.</p>
</div>
<div class="section" id="calling-cluster-shutdown">
<h3>Calling Cluster.shutdown()<a class="headerlink" href="#calling-cluster-shutdown" title="Permalink to this headline">¶</a></h3>
<p>In order to fix some issues around garbage collection and unclean interpreter
shutdowns, version 2.0 of the driver requires you to call <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.shutdown" title="cassandra.cluster.Cluster.shutdown"><code class="xref py py-meth docutils literal"><span class="pre">Cluster.shutdown()</span></code></a>
on your <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><code class="xref py py-class docutils literal"><span class="pre">Cluster</span></code></a> objects when you are through with them.
This helps to guarantee a clean shutdown.</p>
</div>
<div class="section" id="deprecations">
<h3>Deprecations<a class="headerlink" href="#deprecations" title="Permalink to this headline">¶</a></h3>
<p>The following functions have moved from <code class="docutils literal"><span class="pre">cassandra.decoder</span></code> to <code class="docutils literal"><span class="pre">cassandra.query</span></code>.
The original functions have been left in place with a <code class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></code> for
now:</p>
<ul class="simple">
<li><a class="reference internal" href="api/cassandra/decoder.html#cassandra.decoder.tuple_factory" title="cassandra.decoder.tuple_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.decoder.tuple_factory</span></code></a> has moved to
<a class="reference internal" href="api/cassandra/query.html#cassandra.query.tuple_factory" title="cassandra.query.tuple_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.query.tuple_factory</span></code></a></li>
<li><a class="reference internal" href="api/cassandra/decoder.html#cassandra.decoder.named_tuple_factory" title="cassandra.decoder.named_tuple_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.decoder.named_tuple_factory</span></code></a> has moved to
<a class="reference internal" href="api/cassandra/query.html#cassandra.query.named_tuple_factory" title="cassandra.query.named_tuple_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.query.named_tuple_factory</span></code></a></li>
<li><a class="reference internal" href="api/cassandra/decoder.html#cassandra.decoder.dict_factory" title="cassandra.decoder.dict_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.decoder.dict_factory</span></code></a> has moved to
<a class="reference internal" href="api/cassandra/query.html#cassandra.query.dict_factory" title="cassandra.query.dict_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.query.dict_factory</span></code></a></li>
<li><a class="reference internal" href="api/cassandra/decoder.html#cassandra.decoder.ordered_dict_factory" title="cassandra.decoder.ordered_dict_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.decoder.ordered_dict_factory</span></code></a> has moved to
<a class="reference internal" href="api/cassandra/query.html#cassandra.query.ordered_dict_factory" title="cassandra.query.ordered_dict_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.query.ordered_dict_factory</span></code></a></li>
</ul>
</div>
<div class="section" id="dependency-changes">
<h3>Dependency Changes<a class="headerlink" href="#dependency-changes" title="Permalink to this headline">¶</a></h3>
<p>The following dependencies have officially been made optional:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">scales</span></code></li>
<li><code class="docutils literal"><span class="pre">blist</span></code></li>
</ul>
<p>And one new dependency has been added (to enable Python 3 support):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">six</span></code></li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="performance.html" title="Performance Notes"
             >next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting Started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cassandra Driver 2.7.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, DataStax.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>